<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2024-01-28" />

<title>Speeds</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Simon Raymond</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="Titanic_XGBoosting.html">Titanic_XGBoosting</a>
</li>
<li>
  <a href="Titanic_Adaboost.html">Titanic_Adaboost</a>
</li>
<li>
  <a href="Titanic_Nnet.html">Titanic_Nnet</a>
</li>
<li>
  <a href="Titanic_LM_CART_RF.html">Titanic_LM_CART_and_RF</a>
</li>
<li>
  <a href="XGB_2.html">XGB_2</a>
</li>
<li>
  <a href="Speeds.html">Speeds</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Speeds</h1>
<h4 class="date">2024-01-28</h4>

</div>


<div id="preperation" class="section level1">
<h1>Preperation</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span></code></pre></div>
<pre><code>## Loading required package: iterators</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:xgboost&#39;:
## 
##     slice</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;tidyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:Matrix&#39;:
## 
##     expand, pack, unpack</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
</div>
<div id="functions-to-run-the-tests" class="section level1">
<h1>Functions to run the tests</h1>
<p>I will make 3 functions. One with my parallel processing, one with
xgboost pp and then one with no pp at all so n thread = 1.</p>
<p>I have included the code so that you can see it but it is not
important just know that we are looping r times and that the loops use
bootstrapping for splits.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>xgb1 <span class="ot">&lt;-</span> <span class="cf">function</span>(r, xs, y, params, nrounds) {</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Start timer</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r) <span class="co"># Pre-allocate a numeric vector for AUC values</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r) {</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    <span class="co"># Bootstrap sampling</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(xs), <span class="fu">nrow</span>(xs) <span class="sc">*</span> <span class="fl">0.8</span>)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    md_x <span class="ot">&lt;-</span> xs[ind, ]</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    md_y <span class="ot">&lt;-</span> y[ind]</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    test_x <span class="ot">&lt;-</span> xs[<span class="sc">-</span>ind, ] </span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    test_y <span class="ot">&lt;-</span> y[<span class="sc">-</span>ind] </span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    </span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co"># onvert to DMatrix</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> md_x, <span class="at">label =</span> md_y)</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_x, <span class="at">label =</span> test_y)  </span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>, <span class="at">eval_metric =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(<span class="at">params =</span> params, </span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>                       <span class="at">data =</span> dtrain, </span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>                       <span class="at">nrounds =</span> nrounds,</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>                       <span class="at">nthread =</span> <span class="dv">1</span>)</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, dtest)</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(predictions, test_y)</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>    perf <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>    auc[i] <span class="ot">&lt;-</span> perf<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>  }</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>  </span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># End timer</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>time_taken <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(end_time <span class="sc">-</span> start_time, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>  </span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">auc =</span> auc, <span class="at">time_taken =</span> time_taken)</span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>xgb2 <span class="ot">&lt;-</span> <span class="cf">function</span>(r, xs, y, params, nrounds) {</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Start timer</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  </span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  auc <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r) <span class="co"># Initialize the AUC vector to store AUC values for each iteration</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  </span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r) {</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>   <span class="co"># Bootstrap sampling</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(xs), <span class="fu">nrow</span>(xs) <span class="sc">*</span> <span class="fl">0.8</span>)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>    md_x <span class="ot">&lt;-</span> xs[ind, ]</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    md_y <span class="ot">&lt;-</span> y[ind]</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>    test_x <span class="ot">&lt;-</span> xs[<span class="sc">-</span>ind, ] <span class="co"># Potential indexing issue</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>    test_y <span class="ot">&lt;-</span> y[<span class="sc">-</span>ind] <span class="co"># Potential indexing issue</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>    </span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co"># onvert to DMatrix</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> md_x, <span class="at">label =</span> md_y)</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_x, <span class="at">label =</span> test_y)  </span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>, <span class="at">eval_metric =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(<span class="at">params =</span> params, </span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>                       <span class="at">data =</span> dtrain, </span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>                       <span class="at">nrounds =</span> nrounds,</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>                       <span class="at">nthread =</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>    <span class="co"># Predicting and calculating AUC</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, dtest)</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(predictions, test_y)</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>    perf <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>    auc[i] <span class="ot">&lt;-</span> perf<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>  }</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>  </span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># End timer</span></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>time_taken <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(end_time <span class="sc">-</span> start_time, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>  </span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mean_auc =</span> <span class="fu">mean</span>(auc), <span class="at">time_taken =</span> time_taken)</span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>xgbpar <span class="ot">&lt;-</span> <span class="cf">function</span>(r, xs, y, params, nrounds) {</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Start timer</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># Use one less than the total number of cores</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="co"># Parallel processing using foreach</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>r, <span class="at">.combine =</span> <span class="st">&#39;c&#39;</span>, <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&#39;xgboost&#39;</span>, <span class="st">&#39;ROCR&#39;</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>    <span class="co"># Bootstrap sampling</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>    ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(xs), <span class="fu">nrow</span>(xs) <span class="sc">*</span> <span class="fl">0.8</span>)</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>    md_x <span class="ot">&lt;-</span> xs[ind, ]</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>    md_y <span class="ot">&lt;-</span> y[ind]</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    test_x <span class="ot">&lt;-</span> xs[<span class="sc">-</span>ind, ] <span class="co"># Potential indexing issue</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>    test_y <span class="ot">&lt;-</span> y[<span class="sc">-</span>ind] <span class="co"># Potential indexing issue</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>    </span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co"># onvert to DMatrix</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> md_x, <span class="at">label =</span> md_y)</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_x, <span class="at">label =</span> test_y)  </span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>, <span class="at">eval_metric =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(<span class="at">params =</span> params, </span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>                       <span class="at">data =</span> dtrain, </span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>                       <span class="at">nrounds =</span> nrounds,</span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>                       <span class="at">nthread =</span> <span class="dv">1</span>)</span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, dtest)</span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(predictions, test_y)</span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a>    perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a>    perf<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>  }</span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a>  <span class="co"># Stop the cluster</span></span>
<span id="cb15-34"><a href="#cb15-34" tabindex="-1"></a>  <span class="fu">stopCluster</span>(cl)</span>
<span id="cb15-35"><a href="#cb15-35" tabindex="-1"></a>  </span>
<span id="cb15-36"><a href="#cb15-36" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># End timer</span></span>
<span id="cb15-37"><a href="#cb15-37" tabindex="-1"></a>time_taken <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(end_time <span class="sc">-</span> start_time, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span>
<span id="cb15-38"><a href="#cb15-38" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mean_auc =</span> <span class="fu">mean</span>(results), <span class="at">time_taken =</span> time_taken)</span>
<span id="cb15-40"><a href="#cb15-40" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="rows" class="section level1">
<h1>10,000 rows</h1>
<p>Create the data. as a note this data has no relations so it wont be
predictable 20 factor collums 10 numeric</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;num&quot;</span>, i) <span class="sc">:=</span> <span class="fu">runif</span>(<span class="dv">10000</span>))</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>}</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;fac&quot;</span>, i) <span class="sc">:=</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>), <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>}</span></code></pre></div>
<div id="with-a-normal-matrix" class="section level2">
<h2>With a normal Matrix</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span> <span class="sc">-</span> y, <span class="at">data =</span> df)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>y</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">&quot;gbtree&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="dv">1</span>,</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="dv">1</span>,</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>)</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>nrounds <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Execute the functions</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">xgb1</span>(r, xs, y, params, nrounds)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">xgb2</span>(r, xs, y, params, nrounds)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>xp <span class="ot">&lt;-</span> <span class="fu">xgbpar</span>(r, xs, y, params, nrounds)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co"># Extract execution times</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>t1sf <span class="ot">&lt;-</span> x1<span class="sc">$</span>time_taken</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>t2sf <span class="ot">&lt;-</span> x2<span class="sc">$</span>time_taken</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>tpsf <span class="ot">&lt;-</span> xp<span class="sc">$</span>time_taken</span></code></pre></div>
</div>
<div id="with-a-sparse-matrix" class="section level2">
<h2>With a sparse matrix</h2>
<p>For a sparse matrix. The data must be one hot coded then turned into
a dataframe. Then turned into a sparse matrix.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>y</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(<span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">as.data.frame</span>(xs))</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">&quot;gbtree&quot;</span>,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="dv">1</span>,</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="dv">1</span>,</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>nrounds <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># Execute the functions</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">xgb1</span>(r, xs, y, params, nrounds)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">xgb2</span>(r, xs, y, params, nrounds)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>xp <span class="ot">&lt;-</span> <span class="fu">xgbpar</span>(r, xs, y, params, nrounds)</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="co"># Extract execution times</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>t1ssf <span class="ot">&lt;-</span> x1<span class="sc">$</span>time_taken</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>t2ssf <span class="ot">&lt;-</span> x2<span class="sc">$</span>time_taken</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>tpssf <span class="ot">&lt;-</span> xp<span class="sc">$</span>time_taken</span></code></pre></div>
</div>
</div>
<div id="rows-1" class="section level1">
<h1>100,000 rows</h1>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dv">100000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;num&quot;</span>, i) <span class="sc">:=</span> <span class="fu">runif</span>(<span class="dv">100000</span>))</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>}</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;fac&quot;</span>, i) <span class="sc">:=</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>), <span class="dv">100000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>}</span></code></pre></div>
<div id="with-a-normal-matrix-1" class="section level2">
<h2>With a normal Matrix</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span> <span class="sc">-</span> y, <span class="at">data =</span> df)</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>y</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">&quot;gbtree&quot;</span>,</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="dv">1</span>,</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="dv">1</span>,</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>nrounds <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># Execute the functions</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">xgb1</span>(r, xs, y, params, nrounds)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">xgb2</span>(r, xs, y, params, nrounds)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>xp <span class="ot">&lt;-</span> <span class="fu">xgbpar</span>(r, xs, y, params, nrounds)</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co"># Extract execution times</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>t1100 <span class="ot">&lt;-</span> x1<span class="sc">$</span>time_taken</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>t2100 <span class="ot">&lt;-</span> x2<span class="sc">$</span>time_taken</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>tp100 <span class="ot">&lt;-</span> xp<span class="sc">$</span>time_taken</span></code></pre></div>
</div>
<div id="with-a-sparse-matrix-1" class="section level2">
<h2>With a sparse matrix</h2>
<p>For a sparse matrix. The data must be one hot coded then turned into
a dataframe. Then turned into a sparse matrix.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>y</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(<span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">as.data.frame</span>(xs))</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">&quot;gbtree&quot;</span>,</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="dv">1</span>,</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="dv">1</span>,</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>)</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>nrounds <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># Execute the functions</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">xgb1</span>(r, xs, y, params, nrounds)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">xgb2</span>(r, xs, y, params, nrounds)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>xp <span class="ot">&lt;-</span> <span class="fu">xgbpar</span>(r, xs, y, params, nrounds)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="co"># Extract execution times</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>t1s100 <span class="ot">&lt;-</span> x1<span class="sc">$</span>time_taken</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>t2s100 <span class="ot">&lt;-</span> x2<span class="sc">$</span>time_taken</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>tps100 <span class="ot">&lt;-</span> xp<span class="sc">$</span>time_taken</span></code></pre></div>
</div>
</div>
<div id="rows-2" class="section level1">
<h1>500,000 rows</h1>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dv">500000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;num&quot;</span>, i) <span class="sc">:=</span> <span class="fu">runif</span>(<span class="dv">500000</span>))</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>}</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;fac&quot;</span>, i) <span class="sc">:=</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>), <span class="dv">500000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>}</span></code></pre></div>
<div id="with-a-normal-matrix-2" class="section level2">
<h2>With a normal Matrix</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span> <span class="sc">-</span> y, <span class="at">data =</span> df)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>y</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">&quot;gbtree&quot;</span>,</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="dv">1</span>,</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="dv">1</span>,</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>)</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>nrounds <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># Execute the functions</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">xgb1</span>(r, xs, y, params, nrounds)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">xgb2</span>(r, xs, y, params, nrounds)</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>xp <span class="ot">&lt;-</span> <span class="fu">xgbpar</span>(r, xs, y, params, nrounds)</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="co"># Extract execution times</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>t150 <span class="ot">&lt;-</span> x1<span class="sc">$</span>time_taken</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>t250 <span class="ot">&lt;-</span> x2<span class="sc">$</span>time_taken</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>tp50 <span class="ot">&lt;-</span> xp<span class="sc">$</span>time_taken</span></code></pre></div>
</div>
<div id="with-a-sparse-matrix-2" class="section level2">
<h2>With a sparse matrix</h2>
<p>For a sparse matrix. The data must be one hot coded then turned into
a dataframe. Then turned into a sparse matrix.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>y</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(<span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">as.data.frame</span>(xs))</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">&quot;gbtree&quot;</span>,</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="dv">1</span>,</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="dv">1</span>,</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>)</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>nrounds <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># Execute the functions</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">xgb1</span>(r, xs, y, params, nrounds)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">xgb2</span>(r, xs, y, params, nrounds)</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>xp <span class="ot">&lt;-</span> <span class="fu">xgbpar</span>(r, xs, y, params, nrounds)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="co"># Extract execution times</span></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>t1s50 <span class="ot">&lt;-</span> x1<span class="sc">$</span>time_taken</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>t2s50 <span class="ot">&lt;-</span> x2<span class="sc">$</span>time_taken</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>tps50 <span class="ot">&lt;-</span> xp<span class="sc">$</span>time_taken</span></code></pre></div>
</div>
</div>
<div id="presentations" class="section level1">
<h1>Presentations</h1>
<p>Print them out</p>
<p>nrounds is 100 for all</p>
<div id="ks" class="section level2">
<h2>10ks</h2>
<div id="matrix" class="section level3">
<h3>matrix</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>t1sf </span></code></pre></div>
<pre><code>## [1] 18.94556</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>t2sf</span></code></pre></div>
<pre><code>## [1] 9.205918</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>tpsf</span></code></pre></div>
<pre><code>## [1] 7.787381</code></pre>
</div>
<div id="sparse" class="section level3">
<h3>sparse</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>t1ssf </span></code></pre></div>
<pre><code>## [1] 13.69247</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>t2ssf</span></code></pre></div>
<pre><code>## [1] 7.822244</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>tpssf</span></code></pre></div>
<pre><code>## [1] 7.645579</code></pre>
</div>
</div>
<div id="ks-1" class="section level2">
<h2>100ks</h2>
<div id="matrix-1" class="section level3">
<h3>matrix</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>t1100 </span></code></pre></div>
<pre><code>## [1] 201.3526</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>t2100 </span></code></pre></div>
<pre><code>## [1] 75.40563</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>tp100</span></code></pre></div>
<pre><code>## [1] 77.31748</code></pre>
</div>
<div id="sparse-1" class="section level3">
<h3>sparse</h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>t1s100 </span></code></pre></div>
<pre><code>## [1] 138.0607</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>t2s100 </span></code></pre></div>
<pre><code>## [1] 56.01025</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>tps100</span></code></pre></div>
<pre><code>## [1] 55.62783</code></pre>
</div>
</div>
<div id="ks-2" class="section level2">
<h2>500ks</h2>
<div id="matrix-2" class="section level3">
<h3>matrix</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>t150 </span></code></pre></div>
<pre><code>## [1] 1029.636</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>t250 </span></code></pre></div>
<pre><code>## [1] 362.156</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>tp50</span></code></pre></div>
<pre><code>## [1] 660.7573</code></pre>
</div>
<div id="sparse-2" class="section level3">
<h3>sparse</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>t1s50 </span></code></pre></div>
<pre><code>## [1] 765.2692</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>t2s50 </span></code></pre></div>
<pre><code>## [1] 275.3423</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a>tps50 </span></code></pre></div>
<pre><code>## [1] 546.9281</code></pre>
</div>
</div>
<div id="graphs" class="section level2">
<h2>Graphs</h2>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>pres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;10k&quot;</span>, <span class="st">&quot;100k&quot;</span>, <span class="st">&quot;500k&quot;</span>), <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;matrix&quot;</span>, <span class="st">&quot;sparse&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>, <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a>  <span class="at">configuration =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t2&quot;</span>, <span class="st">&quot;tp&quot;</span>), <span class="at">times =</span> <span class="dv">6</span>),</span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(t1sf, t2sf, tpsf, t1ssf, t2ssf, tpssf, </span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>           t1100, t2100, tp100, t1s100, t2s100, tps100, </span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a>           t150, t250, tp50, t1s50, t2s50, tps50)</span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="co"># Plot 1: Sparse times vs Normal matrix times</span></span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a><span class="fu">ggplot</span>(pres, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">interaction</span>(size, configuration), <span class="at">y =</span> time, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Execution Time Comparison: Sparse vs Normal Matrix&quot;</span>,</span>
<span id="cb74-5"><a href="#cb74-5" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Dataset and Configuration&quot;</span>,</span>
<span id="cb74-6"><a href="#cb74-6" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Speeds_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="co"># Plot 2: Comparing t1 vs t2 vs tp by each dataset size</span></span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a><span class="fu">ggplot</span>(pres, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">interaction</span>(size, type), <span class="at">y =</span> time, <span class="at">fill =</span> configuration)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Execution Time Comparison: t1 vs t2 vs tp&quot;</span>,</span>
<span id="cb75-5"><a href="#cb75-5" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Dataset Size and Type&quot;</span>,</span>
<span id="cb75-6"><a href="#cb75-6" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Speeds_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="co"># Plot 3: Time per round for each dataset</span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>pres <span class="ot">&lt;-</span> pres <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_per_round =</span> time <span class="sc">/</span> <span class="dv">100</span>) <span class="co"># Since nrounds is 100 for all</span></span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a><span class="fu">ggplot</span>(pres, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">interaction</span>(size, type, configuration), <span class="at">y =</span> time_per_round)) <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Time Per Round for Each Dataset&quot;</span>,</span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Dataset Size, Type, and Configuration&quot;</span>,</span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Time per Round&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-10"><a href="#cb76-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-11"><a href="#cb76-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Speeds_files/figure-html/unnamed-chunk-33-3.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="co"># Assuming the same setup as before, add the number of rows for each size</span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>pres <span class="ot">&lt;-</span> pres <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nrows =</span> <span class="fu">case_when</span>(</span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a>    size <span class="sc">==</span> <span class="st">&quot;10k&quot;</span> <span class="sc">~</span> <span class="dv">10000</span>,</span>
<span id="cb77-5"><a href="#cb77-5" tabindex="-1"></a>    size <span class="sc">==</span> <span class="st">&quot;100k&quot;</span> <span class="sc">~</span> <span class="dv">100000</span>,</span>
<span id="cb77-6"><a href="#cb77-6" tabindex="-1"></a>    size <span class="sc">==</span> <span class="st">&quot;500k&quot;</span> <span class="sc">~</span> <span class="dv">500000</span></span>
<span id="cb77-7"><a href="#cb77-7" tabindex="-1"></a>  ))</span>
<span id="cb77-8"><a href="#cb77-8" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" tabindex="-1"></a><span class="co"># Calculate the time per row</span></span>
<span id="cb77-10"><a href="#cb77-10" tabindex="-1"></a>pres <span class="ot">&lt;-</span> pres <span class="sc">%&gt;%</span></span>
<span id="cb77-11"><a href="#cb77-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_per_row =</span> time <span class="sc">/</span> nrows)</span>
<span id="cb77-12"><a href="#cb77-12" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" tabindex="-1"></a><span class="co"># Plot: Time per nrow for each dataset</span></span>
<span id="cb77-14"><a href="#cb77-14" tabindex="-1"></a><span class="fu">ggplot</span>(pres, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">interaction</span>(size, type, configuration), <span class="at">y =</span> time_per_row, <span class="at">fill =</span> configuration)) <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Execution Time per Row for Each Dataset and Configuration&quot;</span>,</span>
<span id="cb77-17"><a href="#cb77-17" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Dataset Size, Type, and Configuration&quot;</span>,</span>
<span id="cb77-18"><a href="#cb77-18" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Time per Row (seconds)&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-19"><a href="#cb77-19" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-20"><a href="#cb77-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Speeds_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="co"># Note: Customize the labels and title as needed</span></span></code></pre></div>
</div>
<div id="takaways" class="section level2">
<h2>Takaways</h2>
<p>With factor collums sparse seems to be better. With numeric collums
though it would be worse. XGB is better with internal processing when
nrows is huge. When nrows is smaller though we should use our own
parrallel processing.</p>
<p>Also times include how many loops we are doing which is related to
numcores of the machine being used if you look at our codes</p>
</div>
</div>
<div id="notes-for-myself" class="section level1">
<h1>Notes for myself</h1>
<p>Test light gbm with these. Test adaboost with these. Show that only
numerical data kills a sparse matrix. What about doparrallel with
numcores set inside the xgboost funtions. What about purrr or other ways
of parrallel processing. Do correlations in the data(the data actually
being predictable have a effect). How much does scaling help with speed?
What is faster 1 numeric collum or 1 factor collum? The graphs look ugly
clean them up.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
